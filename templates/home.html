<!DOCTYPE html >
{% load static %}
<html>

<head>
    <title> PseudoRec </title>
    <meta http-equiv="content-type" content="text/html;charset=utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    <link rel="icon" href="{% static 'img/listeners_logo_color_transparent.png' %}">
    <link rel="stylesheet" href="{% static 'css/style.css' %}?v=20251207">
    <link rel="stylesheet" href="{% static 'css/left_aside.css' %}?v=2024011916">
    <link rel="stylesheet" href="{% static 'css/home_movie_rec.css' %}?v=20251207">
    <script src="https://kit.fontawesome.com/6998928b29.js" crossorigin="anonymous"></script>
    <script src="{% static 'js/isotope.pkgd.min.js' %}"></script>
    <script defer src="{% static 'js/main.js' %}"></script>
    <script defer src="{% static 'js/star_logger.js' %}"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="{% static 'js/click_logger.js' %}"></script>
    <script src="{% static 'js/delete_history.js' %}"></script>
    <!--    iconicons-->
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>

    <style>
        /* 전체 레이아웃 */
        body {
            background: #fafafa;
        }

        main .center-main-field {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* 설명 영역 */
        .description {
            background: #fff;
            padding: 32px 40px;
            margin-bottom: 20px;
            border-radius: 12px;
        }

        .description h1 {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1a1a1a;
            margin: 0 0 8px 0;
        }

        .description p {
            font-size: 0.95rem;
            color: #666;
            line-height: 1.6;
            margin: 0;
        }

        /* 모델 선택 영역 */
        .model-rec-header {
            background: #fff;
            padding: 20px 40px;
            margin-bottom: 20px;
            border-radius: 12px;
        }

        .listing-group {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
        }

        .listing-group ul {
            display: flex;
            gap: 8px;
            list-style: none;
            padding: 0;
            margin: 0;
            flex-wrap: wrap;
        }

        .listing-group ul li a {
            display: inline-block;
            padding: 8px 20px;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 500;
            color: #666;
            background: #f5f5f5;
            border: none;
            transition: all 0.2s ease;
            text-decoration: none;
        }

        .listing-group ul li.on a {
            background: #1a1a1a;
            color: #fff;
        }

        .listing-group ul li:not(.on):not(.disabled) a:hover {
            background: #e5e5e5;
            color: #333;
        }

        .listing-group ul li.disabled a {
            opacity: 0.35;
            cursor: not-allowed;
        }

        .listing-group ul li.disabled a:hover {
            background: #f5f5f5;
        }

        /* 검색 영역 */
        .search-icon {
            display: flex;
            gap: 8px;
        }

        .search-icon .btn,
        .search-icon .close {
            padding: 8px 12px;
            border-radius: 8px;
            background: #f5f5f5;
            border: none;
            color: #666;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .search-icon .btn:hover,
        .search-icon .close:hover {
            background: #e5e5e5;
            color: #333;
        }

        .searchBox {
            margin-top: 16px;
            display: none;
        }

        .searchBox.active {
            display: block;
        }

        .searchBox input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e5e5;
            border-radius: 8px;
            font-size: 0.95rem;
            transition: all 0.2s ease;
        }

        .searchBox input:focus {
            outline: none;
            border-color: #1a1a1a;
        }

        /* 영화 그리드 */
        .posters section {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 20px;
            padding: 0;
        }

        .posters article {
            display: block;
        }

        /* 영화 카드 */
        .movie {
            background: #fff;
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .movie:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
        }

        .movie a {
            display: block;
            overflow: hidden;
        }

        .movie img {
            width: 100%;
            height: 320px;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .movie:hover img {
            transform: scale(1.05);
        }

        .movie h2 {
            font-size: 1rem;
            font-weight: 600;
            color: #1a1a1a;
            padding: 16px 16px 8px;
            line-height: 1.4;
            margin: 0;
        }

        .movie p {
            font-size: 0.85rem;
            color: #888;
            padding: 0 16px;
            line-height: 1.5;
            flex-grow: 1;
            margin: 0;
        }

        /* 별점 */
        .rating_box {
            padding: 12px 16px 16px;
        }

        .rating {
            position: relative;
            font-size: 1.4rem;
            color: #e5e5e5;
            letter-spacing: 2px;
            margin-bottom: 8px;
        }

        .rating_star {
            position: absolute;
            left: 0;
            top: 0;
            color: #fbbf24;
            overflow: hidden;
        }

        .rating input[type="range"] {
            width: 100%;
            height: 4px;
            accent-color: #1a1a1a;
            cursor: pointer;
        }

        /* 오른쪽 히스토리 */
        .right-field {
            background: #fff;
            border-radius: 12px;
            padding: 24px !important;
        }

        .right-field h4 {
            font-size: 1rem;
            font-weight: 600;
            color: #1a1a1a;
            margin: 0 0 20px 0;
            padding-bottom: 12px;
            border-bottom: 2px solid #f5f5f5;
        }

        .watched_movie {
            background: #fafafa;
            border-radius: 8px;
            padding: 10px !important;
            margin-bottom: 10px;
            transition: all 0.2s ease;
        }

        .watched_movie:hover {
            background: #f0f0f0;
        }

        .watched_movie .poster img {
            border-radius: 4px;
        }

        .watched_movie .title p {
            font-size: 0.85rem;
            line-height: 1.4;
            color: #333;
            margin: 0;
        }

        .watched_movie .star {
            color: #fbbf24;
            font-size: 0.8rem;
        }

        .delete-icon {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .delete-button {
            cursor: pointer;
            color: #999;
            font-size: 1.1rem;
            padding: 4px;
            transition: color 0.2s ease;
        }

        .delete-button:hover {
            color: #ef4444;
        }

        .right-field .btn-small {
            background: #f5f5f5;
            border: none;
            border-radius: 8px;
            padding: 10px 16px;
            font-weight: 500;
            color: #666;
            transition: all 0.2s ease;
            font-size: 0.85rem;
        }

        .right-field .btn-small:hover {
            background: #e5e5e5;
            color: #ef4444;
        }
    </style>

</head>
<body>

<header>
    {% include 'navbar.html' %}
</header>

<main>
    <div class="side-gutter"></div>
    <div class="inside">
        <div class="center-main-field">
            <div class="model-rec">
                <div class="description">
                    <h1>{{ description1 }}</h1>
                    <p>{{ description2|safe }}</p>
                </div>
                <div class="model-rec-header">
                    <div class="listing-group">
                        <ul>
                            {% if pop_on %}
                            <li class="on"><a href="/movie_recommendation/">인기 영화</a></li>
                            {% else %}
                            <li><a href="/movie_recommendation/">인기 영화</a></li>
                            {% endif %}

                            {% if sasrec_on %}
                            <li class="on disabled"><a href="javascript:void(0);" onclick="return false;">SASRec</a></li>
                            {% else %}
                            <li class="disabled"><a href="javascript:void(0);" onclick="return false;">SASRec</a></li>
                            {% endif %}

                            {% if kprn_on %}
                            <li class="on disabled"><a href="javascript:void(0);" onclick="return false;">KPRN</a></li>
                            {% else %}
                            <li class="disabled"><a href="javascript:void(0);" onclick="return false;">KPRN</a></li>
                            {% endif %}
                            {% if mf_on %}
                            <li class="on"><a href="/movie_recommendation/mf/">General MF</a></li>
                            {% else %}
                            <li><a href="/movie_recommendation/mf/">General MF</a></li>
                            {% endif %}

                            {% if ngcf_on %}
                            <li class="on disabled"><a href="javascript:void(0);" onclick="return false;">NGCF</a></li>
                            {% else %}
                            <li class="disabled"><a href="javascript:void(0);" onclick="return false;">NGCF</a></li>
                            {% endif %}
                        </ul>
                        <div class="search-icon">
                        <span class="icon">
                            <button type="submit" class="btn btn-sm button-theme">
                                <ion-icon name="search-outline" class="searchBtn"></ion-icon>
                            </button>
                            <button type="button" class="close">
                                <ion-icon name="close-outline" class="closeBtn"></ion-icon>
                            </button>
                        </span>
                        </div>
                    </div>

                    <div class="searchBox">
                        <form class="search-header" method="POST">
                            {% csrf_token %}
                            <input type="text" placeholder="Search here . . ." name="keyword" id="search-input">
                        </form>
                    </div>
                </div>
                <div class="posters">
                    <section>
                        {% for r in movie_list %}
                        <article>
                            <div class="movie" dbid={{ r.movieid }} rank="{{ r.rank }}">
                                <a href="/movie/{{ r.movieid }}">
                                    <img src={{ r.posterurl }} alt="">
                                </a>
                                <h2>{{ r.titleko }}</h2>
                                <p>{{ r.synopsis|slice:":100" }}{% if r.synopsis|length > 100 %}...{% endif %}</p>
                                <div class="rating_box">
                                    <div class="rating">
                                        ★★★★★
                                        <span class="rating_star" style="width: {{ r.past_rating }}%">★★★★★</span>
                                        <input type="range" value="0" step="1" min="0" max="10">
                                    </div>
                                </div>
                            </div>
                        </article>
                        {% endfor %}
                    </section>
                </div>
            </div>
        </div>
        {% include 'right_watched_list.html' %}
    </div>
</main>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm"
        crossorigin="anonymous"></script>
<script>
    let searchBtn = document.querySelector('.searchBtn');
    let closeBtn = document.querySelector('.closeBtn');
    let searchBox = document.querySelector('.searchBox');
    let searchActive = false; // searchBtn의 상태를 추적하는 변수
    let searchInput = null;

    function initSearchInput() {
        searchInput = document.getElementById('search-input');
        if (searchInput) {
            // transitionend 이벤트를 기다려서 focus를 주기
            searchBox.addEventListener('transitionend', function () {
                // transition이 완전히 끝난 후에 focus를 줌
                searchInput.focus();
            }, {once: true}); // 이벤트 리스너는 한 번만 실행되도록 once 옵션 사용
        } else {
            setTimeout(initSearchInput, 100); // 100ms 마다 다시 시도
        }
    }


    searchBtn.onclick = function () {
        if (!searchActive) { // searchBtn이 클릭되지 않은 상태일 때만 실행
            searchBox.classList.add('active');
            closeBtn.classList.add('active');
            searchBtn.classList.add('active');
            initSearchInput();
            searchActive = true; // searchBtn이 클릭된 상태로 변경
            console.log({'searchBox activated. searchActive': searchActive});
        } else {
            console.log({'searchActive': searchActive});
            searchMovie(); // searchBtn이 활성화된 상태인 경우 검색 함수 실행
        }
    }
    closeBtn.onclick = function () {
        searchBox.classList.remove('active');
        closeBtn.classList.remove('active');
        searchBtn.classList.remove('active');
        searchActive = false; // searchBtn이 클릭되지 않은 상태로 변경
        console.log({'searchBox deactivated. searchActive': searchActive});
    }

    function searchMovie() {
        let searchValue = document.getElementById('search-input').value.trim();
        console.log({'searchMovie() function. searchActive : ': searchActive});
        if (searchActive) { // searchBtn이 클릭된 상태인 경우에만 실행
            if (searchValue.length > 1) {
                location.href = '/movie/search/' + searchValue + "/";
            } else {
                alert('검색어 "' + searchValue + '"가 너무 짧습니다.');
                return;
            }
        }
    };
    document.getElementById('search-input').addEventListener('keyup', function (event) {
        if (searchActive) {
            if (event.key === 'Enter') {
                console.log('Search Enter key pressed');
                searchMovie();
            } else if (event.key === 'Escape') {
                console.log('Escape key pressed');
                closeBtn.click();
            }
        }
    });

</script>
</body>

</html>
